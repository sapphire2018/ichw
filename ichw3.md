# 高速缓存浏览器                                 
       
* 主要结构
  * Cache储存体：存放由主存调入的指令与数据块。
  * 地址转换部件：建立目录表以实现主存地址到缓存地址的转换。
  * 替换部件：在缓存已满时按一定策略进行数据块替换，并修改地址转换部件。
***
* 工作原理
![工作原理简图](http://a3.qpic.cn/psb?/V11SipxF4CTGfB/Uqhrl.vfWY8bF8kXgdQMBKI8zke0vNzpWndWfz3SzHc!/c/dCIBAAAAAAAA&ek=1&kp=1&pt=0&bo=fANmAXwDZgEBACc!&tl=3&vuin=1204373649&tm=1538794800&sce=60-2-2&rf=0-0)高速缓冲存储器通常由高速存储器、联想存储器、替换逻辑电路和相应的控制线路组成。在有高速缓冲存储器的计算机系统中，中央处理器存取主存储器的地址划分为行号、列号和组内地址三个字段。于是，主存储器就在逻辑上划分为若干行;每行划分为若干的存储单元组;每组包含几个或几十个字。高速存储器也相应地划分为行和列的存储单元组。二者的列数相同，组的大小也相同，但高速存储器的行数却比主存储器的行数少得多。
    
联想存储器用于地址联想，有与高速存储器相同行数和列数的存储单元。当主存储器某一列某一行存储单元组调入高速存储器同一列某一空着的存储单元组时，与联想存储器对应位置的存储单元就记录调入的存储单元组在主存储器中的行号。
      
当中央处理器存取主存储器时，硬件首先自动对存取地址的列号字段进行译码，以便将联想存储器该列的全部行号与存取主存储器地址的行号字段进行比较:若有相同的，表明要存取的主存储器单元已在高速存储器中，称为命中，硬件就将存取主存储器的地址映射为高速存储器的地址并执行存取操作;若都不相同，表明该单元不在高速存储器中，称为脱靶，硬件将执行存取主存储器操作并自动将该单元所在的那一主存储器单元组调入高速存储器相同列中空着的存储单元组中，同时将该组在主存储器中的行号存入联想存储器对应位置的单元内。

当出现脱靶而高速存储器对应列中没有空的位置时，便淘汰该列中的某一组以腾出位置存放新调入的组，这称为替换。确定替换的规则叫替换算法，常用的替换算法有:最近最少使用算法(LRU)、先进先出法(FIFO)和随机法(RAND)等。替换逻辑电路就是执行这个功能的。另外，当执行写主存储器操作时，为保持主存储器和高速存储器内容的一致性，对命中和脱靶须分别处理。
***
  * 存储层次
    * 主-辅存存储层次
    由于计算机主存容量相对于程序员所需要的容量来说总是太小，程序与数据从辅存调入主存是由程序员自己安排的，程序员必须花费很大精力和时间把大程序预先分成块，确定好这些程序块在辅存中的位置和装入主存的地址，而且还要预先安排好程序运行时各块如何和何时调入调出，因此存在存储空间的分配问题。操作系统的形成和发展使得程序员尽可能摆脱主、辅存之间的地址定位，同时形成了支持这些功能的"辅助硬件"，通过软件、硬件的结合，把主存和辅存统一成了一个整体，如图所示。这时，由主存、辅存形成了一个存储层次，即存储系统。从整体看，其速度接近于主存的速度，其容量则接近于辅存的容量，而每位的平均价格也接近于廉价的慢速的辅存平均价格。这种系统不断发展和完善，就逐步形成了现在广泛使用的虚拟存储系统。在系统中，应用程序员可用机器指令地址码对整个程序统一编址，如同程序员具有对应这个地址码宽度的全部虚存空间一样。该空间可以比主存实际空间大得多，以致可以存得下整个程序。这种指令地址码称为虚地址(虚存地址、虚拟地址)或逻辑地址，其对应的存储容量称为虚存容量或虚存空间;而把实际主存的地址称为物理地址、实(存)地址，其对应的存储容量称为主存容量、实存容量或实(主)存空间
    * CACHE-主存存储层次
    当用虚地址访问主存时，机器自动地把它经辅助软件、硬件变换成主存实地址。查看这个地址所对应的单元内容是否已经装入主存，如果在主存就进行访问，如果不在主存内就经辅助软件、硬件把它所在的那块程序和数据由辅存调入主存，而后进行访问。这些操作都不必由程序员来安排，也就是说，对应用程员员是透明的。 主-辅存层次解决了存储器大容量要求和低成本之间的矛盾。 在速度方面，计算机的主存和CPU直保持了大约一个数量级的差距。显然这个差距限制了CPU速度潜力的发挥。为了弥合这个差距，仅采用一种工艺的单一存储器是行不通的，必须进一步从计算机系统结构和组织上去研究。设置高速缓冲存储器(Cache)是解决存取速度的重要方法。在CPU和主存中间设置高速缓冲存储器，构成高速缓存(Cache)-主存层次，要求Cache在速度上能跟得上CPU的要求。Cache-主存间的地址映象和调度吸取了比它较早出现的主-辅存存储层次的技术，不同的是因其速度要求高，不是由软、硬件结合而完全由硬件来实现
    ***
  * 地址映象与转换
  地址映象是指某一数据在内存中的地址与在缓冲中的地址，两者之间的对应关系。  
    * 1、全相联方式  
        地址映象规则:主存的任意一块可以映象到Cache中的任意一块   
        (1) 主存与缓存分成相同大小的数据块。  
        (2) 主存的某一数据块可以装入缓存的任意一块空间中。如果Cache的块数为Cb，主存的块数为Mb，则映象关系共有Cb×Mb种。目录表存放在相关(联)存储器          中，其中包括三部分:数据块在主存的块地址、存入缓存后的块地址、及有效位(也称装入位)。由于是全相联方式，因此，目录表的容量应当与缓存的块数相          同。  
    * 2、直接相联方式  
    (1) 主存与缓存分成相同大小的数据块。  
    (2) 主存容量应是缓存容量的整数倍，将主存空间按缓存的容量分成区，主存中每一区的块数与缓存的总块数相等。  
    (3) 主存中某区的一块存入缓存时只能存入缓存中块号相同的位置。  
     主存中各区内相同块号的数据块都可以分别调入缓存中块号相同的地址中，但同时只能有一个区的块存入缓存。由于主、缓存块号相同，因此，目录登记时，只记录      调入块的区号即可。主、缓存块号及块内地址两个字段完全相同。目录表存放在高速小容量存储器中，其中包括二部分:数据块在主存的区号和有效位。目录表的容      量与缓存的块数相同。
    * 3、组相联映象方式  
    组相联的映象规则:  
      (1) 主存和Cache按同样大小划分成块。  
      (2) 主存和Cache按同样大小划分成组。  
      (3) 主存容量是缓存容量的整数倍，将主存空间按缓冲区的大小分成区，主存中每一区的组数与缓存的组数相同。  
      (4) 当主存的数据调入缓存时，主存与缓存的组号应相等，也就是各区中的某一块只能存入缓存的同组号的空间内，但组内各块地址之间则可以任意存放，即从主       存的组到Cache的组之间采用直接映象方式;在两个对应的组内部采用全相联映象方式。  
      主存地址与缓存地址的转换有两部分，组地址是按直接映象方式，按地址进行访问，而块地址是采用全相联方式，按内容访问。组相联的地址转换部件也是采用相       关存储器实现。
    
***
  * 替换策略  
      *(1).随机法(RAND法)*  
        随机法是随机地确定替换的存储块。设置一个随机数产生器，依据所产生的随机数，确定替换块。这种方法简单、易于实现，但命中率比较低。  
      *(2).先进先出法(FIFO法)*  
        先进先出法是选择那个最先调入的那个块进行替换。当最先调入并被多次命中的块，很可能被优先替换，因而不符合局部性规律。这种方法的命中率比随机法好         些，但还不满足要求。  
      *(3).最近最少使用法(LRU法)*  
        LRU法是依据各块使用的情况， 总是选择那个最近最少使用的块被替换。这种方法比较好地反映了程序局部性规律。 实现LRU策略的方法有多种。
